<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI QA Project Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    .loading-spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid #fff;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
      display: none;
    }
    .loading-spinner.active { display: inline-block; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body class="bg-gray-50 min-h-screen p-6">

  <div class="max-w-3xl mx-auto">

    <header class="text-center mb-6">
      <h1 class="text-3xl font-bold text-gray-800">AI QA Project Generator</h1>
      <p class="text-gray-500 mt-2">Convert raw requirements into a ready-to-use LLM test project.</p>
    </header>

    <!-- Input Section -->
    <div class="bg-white p-6 rounded-xl shadow mb-6">
      <h2 class="text-xl font-semibold mb-3">1. Paste your requirements/prompts</h2>
      <textarea id="requirementsInput" rows="15" class="w-full p-3 border rounded-lg border-gray-300 focus:ring-blue-500 focus:border-blue-500 transition" placeholder="Enter one requirement per line"></textarea>

      <h2 class="text-xl font-semibold mt-4 mb-2">2. OpenAI API Key</h2>
      <input type="text" id="apiKeyInput" class="w-full p-3 border rounded-lg border-gray-300 focus:ring-blue-500 focus:border-blue-500 transition" placeholder="sk-..." />

      <button id="generateButton" onclick="generateProject()" class="mt-4 px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow hover:bg-blue-700 transition flex items-center justify-center">
        <span>Generate Project</span>
        <div id="spinner" class="loading-spinner ml-3"></div>
      </button>

      <p id="errorMessage" class="text-red-600 mt-2 hidden"></p>
    </div>

    <!-- Preview Section -->
    <div id="previewSection" class="hidden bg-white p-6 rounded-xl shadow mb-6">
      <h2 class="text-xl font-semibold mb-3">Preview of Generated CSV</h2>
      <div class="overflow-auto max-h-64 border rounded p-3 bg-gray-50">
        <pre id="csvPreview" class="text-sm"></pre>
      </div>
    </div>

    <!-- Download Section -->
    <div id="downloadSection" class="hidden bg-white p-6 rounded-xl shadow mb-6">
      <button onclick="downloadZip()" class="w-full px-6 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition">Download Project</button>
    </div>

  </div>

  <script>
    let structuredData = null;

    function showSpinner(show) {
      const spinner = document.getElementById('spinner');
      spinner.classList.toggle('active', show);
      document.getElementById('generateButton').disabled = show;
    }

    function displayError(msg) {
      const errorEl = document.getElementById('errorMessage');
      errorEl.textContent = msg;
      errorEl.classList.remove('hidden');
      showSpinner(false);
    }

    async function generateProject() {
      const requirementsText = document.getElementById('requirementsInput').value.trim();
      const apiKey = document.getElementById('apiKeyInput').value.trim();

      if (!requirementsText) { displayError("Please enter your requirements."); return; }
      if (!apiKey) { displayError("Please enter your OpenAI API key."); return; }

      showSpinner(true);
      document.getElementById('errorMessage').classList.add('hidden');
      document.getElementById('previewSection').classList.add('hidden');
      document.getElementById('downloadSection').classList.add('hidden');

      const requirements = requirementsText.split('\n').map(r => r.trim()).filter(r => r);

      // Prepare CSV rows
      structuredData = requirements.map(req => {
        return {
          question: req,
          icontains: "icontains: ...", // placeholder
          rubric: "llm-rubric: answer should be factually correct"
        };
      });

      // Preview
      let csvText = 'question,__expected,__expected2\n';
      structuredData.forEach(row => {
        csvText += `"${row.question}","${row.icontains}","${row.rubric}"\n`;
      });
      document.getElementById('csvPreview').textContent = csvText;
      document.getElementById('previewSection').classList.remove('hidden');
      document.getElementById('downloadSection').classList.remove('hidden');

      showSpinner(false);
    }

    function downloadZip() {
      if (!structuredData) return;

      const zip = new JSZip();
      const root = zip.folder("MINEVAL");
      const promptsFolder = root.folder("prompts");
      const testsFolder = root.folder("tests");

      // TXT
      const txtContent = `You are a helpful assistant that provides accurate and concise answers to questions.

Question: {{question}}

Please provide a clear and accurate answer.`;
      promptsFolder.file("prompt.txt", txtContent);

      // CSV
      let csvText = 'question,__expected,__expected2\n';
      structuredData.forEach(row => {
        csvText += `"${row.question}","${row.icontains}","${row.rubric}"\n`;
      });
      testsFolder.file("basic_tests.csv", csvText);

      // YAML
      const yamlContent = `prompts:
  - file://prompts/prompt.txt
tests:
  - file://tests/basic_tests.csv
providers:
  - openai:gpt-4o-mini
  - openai:gpt-4`;
      root.file("promptfooconfig.yaml", yamlContent);

      zip.generateAsync({type:"blob"}).then(function(content) {
        const link = document.createElement("a");
        link.href = URL.createObjectURL(content);
        link.download = "MINEVAL.zip";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      });
    }
  </script>
</body>
</html>
