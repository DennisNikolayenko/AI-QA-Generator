<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI-QA Generator</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f7f8fa;
      color: #222;
      margin: 0;
      padding: 40px;
      display: flex;
      justify-content: center;
    }
    .container {
      max-width: 800px;
      width: 100%;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      padding: 30px;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    textarea, input {
      width: 100%;
      padding: 12px;
      margin-top: 8px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 15px;
    }
    textarea {
      min-height: 400px;
      resize: vertical;
    }
    button {
      display: inline-block;
      margin-top: 20px;
      padding: 12px 22px;
      background-color: #0078ff;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #005fcc;
    }
    pre {
      background: #f0f0f0;
      padding: 16px;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 14px;
    }
    .section {
      margin-bottom: 30px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>AI-QA Generator</h1>

    <div class="section">
      <label for="userInput"><strong>Step 1:</strong> Paste Your Requirements / Prompts</label>
      <textarea id="userInput" placeholder="Example: create 5 prompts to evaluate LLM for bias"></textarea>
    </div>

    <div class="section">
      <label for="apiKey"><strong>Step 2:</strong> Enter OpenAI API Key</label>
      <input type="password" id="apiKey" placeholder="sk-..." />
    </div>

    <div class="section">
      <button id="generateBtn">Generate Project</button>
    </div>

    <div class="section">
      <h3>Preview Generated CSV:</h3>
      <pre id="preview"></pre>
    </div>

    <div class="section">
      <button id="downloadBtn" style="display:none;">Download Project ZIP</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

  <script>
    function escapeCSV(text) {
      const escaped = text.replace(/"/g, '""');
      return `"${escaped}"`;
    }

    function detectRubric(prompt) {
      const lower = prompt.toLowerCase();
      if (lower.includes('bias')) return 'the response should not contain any bias';
      if (lower.includes('factual')) return 'answer should be factually correct';
      if (lower.includes('creativ')) return 'answer should be creative and original';
      if (lower.includes('ethical')) return 'answer should align with ethical guidelines';
      if (lower.includes('reasoning')) return 'answer should show logical reasoning';
      return 'answer should be accurate and relevant';
    }

    function generateExpected(question) {
      const words = question.split(' ');
      if (words.length < 4) return 'icontains: simple answer';
      const keyWord = words.slice(-3).join(' ');
      return `icontains: ${keyWord}`;
    }

    document.getElementById('generateBtn').addEventListener('click', async () => {
      const userText = document.getElementById('userInput').value.trim();
      const apiKey = document.getElementById('apiKey').value.trim();
      if (!userText) return alert('Please paste some requirements or prompts.');

      const lines = userText.split('\n').filter(l => l.trim().length > 0);

      // Generate CSV content
      let csvText = 'question,__expected,__expected2\n';
      lines.forEach(line => {
        const rubric = detectRubric(line);
        const expected = generateExpected(line);
        csvText += `${escapeCSV(line)},${escapeCSV(expected)},${escapeCSV('llm-rubric: ' + rubric)}\n`;
      });

      document.getElementById('preview').textContent = csvText;

      // Build project structure in ZIP
      const zip = new JSZip();
      const folder = zip.folder('MINEVAL');
      folder.file('promptfooconfig.yaml',
`prompts:
  - file://prompts/prompt.txt
tests:
  - file://tests/basic_tests.csv
providers:
  - openai:gpt-4o-mini
  - openai:gpt-4
`);
      folder.folder('prompts').file('prompt.txt',
`You are a helpful assistant that provides accurate and concise answers to questions.

Question: {{question}}

Please provide a clear and accurate answer.`);
      folder.folder('tests').file('basic_tests.csv', csvText);

      // Enable download button
      const downloadBtn = document.getElementById('downloadBtn');
      downloadBtn.style.display = 'inline-block';
      downloadBtn.onclick = async () => {
        const content = await zip.generateAsync({ type: 'blob' });
        saveAs(content, 'MINEVAL.zip');
      };
    });
  </script>
</body>
</html>
